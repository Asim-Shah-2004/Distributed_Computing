# Dynamic Load Balancing Configuration (Least Connections)
upstream dynamic_backend {
    least_conn;  # Routes to server with fewest active connections
    server app1:3000;
    server app2:3000;
    server app3:3000;
}

server {
    listen 80;
    server_name dynamic.example.com;

    location / {
        proxy_pass http://dynamic_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Add header to identify which load balancing method was used
        add_header X-Load-Balancing-Method "Dynamic (Least Connections)" always;
    }
}

# Dynamic Load Balancing with Weighted Servers based on capacity
upstream dynamic_weighted_backend {
    server app1:3000 weight=3;  # Server 1 can handle more traffic (3x)
    server app2:3000 weight=2;  # Server 2 has medium capacity (2x)
    server app3:3000 weight=1;  # Server 3 has lower capacity (1x)
}

server {
    listen 80;
    server_name dynamic-weighted.example.com;

    location / {
        proxy_pass http://dynamic_weighted_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Add header to identify which load balancing method was used
        add_header X-Load-Balancing-Method "Dynamic (Weighted)" always;
    }
}